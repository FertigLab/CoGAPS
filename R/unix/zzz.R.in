.onLoad <- function(lib, pkg)
{
  ## Load the rjags wrapper ...
  libdir <- "@GAPSJAGS_LIB@"
  if (is.null(getOption("jags.libdir"))) {
      options("jags.libdir" = libdir)
  }

  jagsLib <- file.path(libdir, 'libjags.so')
  if (file.exists(jagsLib)) {
    dyn.load(jagsLib)
  }

  jrmathLib <- file.path(libdir, 'libjrmath.so')
  if (file.exists(jrmathLib)) {
    dyn.load(jrmathLib)
  }
 
  library.dynam("CoGAPS", pkg, lib, local=FALSE)

  ## ... and the modules
  moddir <- "@GAPSJAGS_MODULES@"
  if (is.null(getOption("jags.moddir"))) {
      options("jags.moddir" = moddir)
  }
  load.module("basemod")
  load.module("gaps")

  .Call("init_jags_console", PACKAGE="CoGAPS")

  ## Set progress bar type
  if (is.null(getOption("jags.pb"))) {
      options("jags.pb"="text")
  }
}

